<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор трансфера</title>
    <style>
        .form-group {
            margin-bottom: 15px;
        }

        select,
        input[type="button"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
        }

        .step {
            display: none;
        }

        .active {
            display: block;
        }

        .car-options {
            display: flex;
            gap: 15px;
        }

        .car-card {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            width: 150px;
            cursor: pointer;
        }

        .car-card:hover {
            background-color: #f0f0f0;
        }
    </style>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9440bea9-20b9-41fc-8aed-6846cecae179&lang=ru_RU"
        type="text/javascript"></script>
</head>

<body>

    <!-- Шаг 1: Выбор направления -->
    <div class="step active" id="step1">
        <div class="form-group">
            <label for="departure">Откуда:</label>
            <select id="departure">
                <option value="" disabled selected>Выберите пункт отправления</option>
                <option value="Москва">Москва</option>
                <option value="Санкт-Петербург">Санкт-Петербург</option>
                <option value="Казань">Казань</option>
                <option value="Сочи">Сочи</option>
            </select>
        </div>

        <div class="form-group">
            <label for="destination">Куда:</label>
            <select id="destination">
                <option value="" disabled selected>Выберите пункт назначения</option>
                <option value="Москва">Москва</option>
                <option value="Санкт-Петербург">Санкт-Петербург</option>
                <option value="Казань">Казань</option>
                <option value="Сочи">Сочи</option>
            </select>
        </div>

        <div class="form-group">
            <input type="button" value="Далее" id="toStep2">
        </div>
    </div>

    <!-- Шаг 2: Выбор класса авто + маршрут -->
    <div class="step" id="step2">
        <div id="map" style="width: 100%; height: 400px;"></div>

        <div class="car-options">
            <!-- Карточки с автомобилями будут добавляться здесь -->
        </div>
    </div>

    <script>
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const toStep2Button = document.getElementById('toStep2');
        const carOptionsContainer = document.querySelector('.car-options');

        let departure, destination;

        toStep2Button.addEventListener('click', function () {
            departure = document.getElementById('departure').value;
            destination = document.getElementById('destination').value;

            if (!departure || !destination) {
                alert('Пожалуйста, выберите пункты отправления и назначения.');
                return;
            }

            step1.classList.remove('active');
            step2.classList.add('active');

            // Инициализация карты
            ymaps.ready(init);

            // Отображение карточек с автомобилями
            renderCarOptions();
        });

        function init() {
            const map = new ymaps.Map("map", {
                center: [55.751574, 37.573856], // Центр карты по умолчанию (Москва)
                zoom: 7
            });

            // function getCoordinates(place) {
            //     ymaps.geocode(place, { results: 1 }).then(function (res) {
            //         var firstGeoObject = res.geoObjects.get(0),
            //         coords = firstGeoObject.geometry.getCoordinates();
            //         return coords;
            //     });
            // }

            // console.log(getCoordinates(departure));

            console.log([departure, destination]);

            // ymaps.geocode(departure, {
            //     results: 1
            // }).then(function (res) {
            //     var firstGeoObject = res.geoObjects.get(0),
            //         coords = firstGeoObject.geometry.getCoordinates();
            //     console.log(coords);
            // });

            // ymaps.geocode(destination, {
            //     results: 1
            // }).then(function (res) {
            //     var firstGeoObject = res.geoObjects.get(0),
            //         coords = firstGeoObject.geometry.getCoordinates();
            //     console.log(coords);
            // });


            ymaps.route([departure, destination]).then(function (route) {
                map.geoObjects.add(route);
                // console.log(Math.round(route.getLength() / 1000));
                // TODO передать в getBounds() координаты обеих точек
                map.setBounds(route.getBounds());

                // Получение расстояния маршрута и вывод в консоль
                const distance = route.getLength(); // Расстояние в метрах
                console.log(distance);
                console.log(`Расстояние маршрута: ${(distance / 1000).toFixed(2)} км`); // Вывод в км с двумя знаками после запятой
            }, function (error) {
                alert('Не удалось построить маршрут');
            });
        }


        function renderCarOptions() {
            const carOptions = [
                { name: 'Эконом', pricePerKm: 10, image: 'economy.png' },
                { name: 'Комфорт', pricePerKm: 15, image: 'comfort.png' },
                { name: 'Бизнес', pricePerKm: 20, image: 'business.png' }
            ];

            carOptions.forEach(car => {
                const carCard = document.createElement('div');
                carCard.classList.add('car-card');
                carCard.innerHTML = `
          <h3>${car.name}</h3>
          <p>Цена за км: ${car.pricePerKm} руб.</p>
        `;
                carCard.addEventListener('click', function () {
                    // Логика отправки данных (выбранный автомобиль, расчет и т.д.)
                    alert(`Вы выбрали: ${car.name}`);
                });
                carOptionsContainer.appendChild(carCard);
            });
        }
    </script>

</body>

</html>