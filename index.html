<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞</title>
    <style>
        #transferForm {
            .form-group {
                display: flex;
                gap: 2rem;
                align-items: flex-end;
                margin-bottom: 2rem;

                @media(max-width: 992px) {
                    flex-wrap: wrap;
                }
            }

            .form-group-item {
                max-width: 100%;
                width: 100%;
            }

            label {
                font-size: 1rem;
                opacity: 0.8;
            }

            input {
                letter-spacing: normal !important;
            }

            button,
            input[type=button] {
                background-color: #34ccff;
                cursor: pointer;
                border: none !important;
                padding: .5rem 2rem !important;
            }

            button:hover,
            input[type=button]:hover {
                background-color: #00bfff;
            }

            #destination-suggestions,
            #departure-suggestions {
                background-color: #dadada;
                position: absolute;
                overflow: scroll;
                max-height: 200px;
                min-width: 300px;
                position: absolute;
            }

            .suggestion-item {
                cursor: pointer;
                padding: .5rem 1rem;
            }

            .suggestion-item:hover {
                background-color: #34ccff;
            }

            .step {
                display: none;
            }

            .step.active {
                display: block;
            }

            #step1 {
                border: 1px solid #666;
                margin-bottom: 2rem;
                padding: 1rem;
            }

            .car-option {
                display: flex;
                gap: 1rem;
                border: 1px solid #666;
                margin-bottom: 2rem;
                padding: 1rem;
                justify-content: space-between;
                align-items: flex-end;
                flex-wrap: wrap;
            }

            .car-option-image {
                width: 200px;

                img {
                    width: 200px;
                }
            }

            .car-option-info {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                max-width: 600px;
            }

            .car-option-title {
                font-size: 1.5rem;
            }

            .car-option-brands {
                font-size: 1.1rem;
            }

            .car-option-size {
                display: flex;
                gap: 1rem;
                font-size: 0.8rem;
            }

            .car-option-order-price {
                font-weight: bold;
                margin-bottom: 1rem;
                font-size: 1.5rem;
            }

            #map {
                width: 100%;
                height: 400px;

                input {
                    all: unset;
                }
            }

            #backToStart {
                display: block;
                cursor: pointer;
            }
        }
    </style>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=9440bea9-20b9-41fc-8aed-6846cecae179&lang=ru_RU"
        type="text/javascript"></script>
</head>

<body>

    <form id="transferForm">
        <div class="step active" id="step1">
            <div class="form-group">
                <div class="form-group-item">
                    <label for="departure">–û—Ç–∫—É–¥–∞:</label>
                    <input type="text" id="departure" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—É–Ω–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è">
                    <div id="departure-suggestions" class="suggestions"></div>
                    <ul id="cities-list" style="display: none;">
                        <li>–°–æ—á–∏</li>
                        <li>–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –≤–æ–¥—ã</li>
                        <li>–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫</li>
                    </ul>
                </div>
                <div class="form-group-item">
                    <label for="destination">–ö—É–¥–∞:</label>
                    <input type="text" id="destination" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è">
                    <div id="destination-suggestions" class="suggestions"></div>
                    <ul id="cities-list-destination" style="display: none;">
                        <li>–ê–≤–∏–ª–æ-–£—Å–ø–µ–Ω–∫–∞</li>
                        <li>–ê–¥–ª–µ—Ä</li>
                        <li>–ê–∑–æ–≤</li>
                        <li>–ê–Ω–∞–ø–∞</li>
                        <li>–ê–Ω–∞–ø–∞ –∂–¥ –≤–æ–∫–∑–∞–ª</li>
                        <li>–ê–Ω–∞–ø—Å–∫–∞—è</li>
                        <li>–ê–Ω–∞—Å—Ç–∞—Å–∏–µ–≤—Å–∫–∞—è</li>
                        <li>–ë–∞—Ç–∞–π—Å–∫</li>
                        <li>–ë–µ–ª–æ—Ä–µ—á–µ–Ω—Å–∫</li>
                        <li>–ë–µ—Ç—Ç–∞</li>
                        <li>–ë–ª–∞–≥–æ–≤–µ—â–µ–Ω—Å–∫–∞—è</li>
                        <li>–í–∞—Ä–µ–Ω–∏–∫–æ–≤—Å–∫–∞—è</li>
                        <li>–í–æ–ª–≥–æ–¥–æ–Ω—Å–∫</li>
                        <li>–ì–µ–ª–µ–Ω–¥–∂–∏–∫</li>
                        <li>–î–∏–≤–Ω–æ–º–æ—Ä—Å–∫–æ–µ</li>
                        <li>–î–æ–º–æ–¥–µ–¥–æ–≤–æ</li>
                        <li>–ï–π—Å–∫</li>
                        <li>–ö–∞–Ω–µ–≤—Å–∫–∞—è</li>
                        <li>–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä</li>
                        <li>–ö—Ä—ã–º—Å–∫</li>
                        <li>–ú–∞–π–∫–æ–ø</li>
                        <li>–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã</li>
                        <li>–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –í–æ–¥—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç</li>
                        <li>–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫</li>
                        <li>–ù–æ–≤–æ—Ç–∏—Ç–≤—Ä–æ–≤—Å–∫–∞—è</li>
                        <li>–ü–∞–≤–ª–æ–≤—Å–∫–∞—è</li>
                        <li>–ü–æ—Ä—Ç –ö–∞–≤–∫–∞–∑</li>
                        <li>–†–æ—Å—Ç–æ–≤</li>
                        <li>–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å</li>
                        <li>–°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å</li>
                        <li>–°–ª–∞–≤—è–Ω—Å–∫-–Ω–∞-–ö—É–±–∞–Ω–∏</li>
                        <li>–°–æ—á–∏</li>
                        <li>–°–æ—á–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç</li>
                        <li>–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å</li>
                        <li>–°—Ç–∞—Ä–æ—Ç–∏—Ç–∞—Ä–æ–≤—Å–∫–∞—è</li>
                        <li>–¢–∞–≥–∞–Ω—Ä–æ–≥</li>
                        <li>–¢–∞–º–∞–Ω—å</li>
                        <li>–¢–µ–º—Ä—é–∫</li>
                        <li>–¢–∏–º–∞—à–µ–≤—Å–∫</li>
                        <li>–¢–∏—Ö–æ—Ä–µ—Ü–∫</li>
                        <li>–¢—É–∞–ø—Å–µ</li>
                        <li>–¢—É–∞–ø—Å–µ –∂–¥ –≤–æ–∫–∑–∞–ª</li>
                        <li>–§–µ–æ–¥–æ—Å–∏—è</li>
                        <li>–®–∞—Ö—Ç—ã</li>
                    </ul>
                </div>
            </div>

            <div class="form-group">
                <div class="form-group-item">
                    <label for="start">–î–∞—Ç–∞ –ø–æ–µ–∑–¥–∫–∏:</label>
                    <input type="date" id="start" name="trip-start" value="2000-01-01" required />
                </div>
                <div class="form-group-item">
                    <input type="button" value="–ù–∞–π—Ç–∏" id="toStep2">
                </div>
            </div>
        </div>

        <div class="step" id="step2">
            <div id="car-options">
                <div class="car-option" data-name="–ö–æ–º—Ñ–æ—Ä—Ç" data-price-per-km="30">
                    <div class="car-option-image">
                        <img src="komfort.png" alt="komfort">
                    </div>
                    <div class="car-option-info">
                        <div class="car-option-title">–ö–æ–º—Ñ–æ—Ä—Ç (–¥–æ 4 —á–µ–ª–æ–≤–µ–∫)</div>
                        <div class="car-option-brands">
                            Toyota Avensis, Kia Cerato, Skoda Octavia, Geely Emgrand, BAIC U5, Hyundai Elantra</div>
                        <div class="car-option-size">
                            <div><span class="icon_people"></span>–¥–æ 4 —á–µ–ª–æ–≤–µ–∫</div>
                            <div><span class="icon_cases"></span>–¥–æ 3 —á–µ–º–æ–¥–∞–Ω–æ–≤</div>
                        </div>
                    </div>
                    <div class="car-option-order">
                        <small class="car-option-order-points"></small>
                        <div class="car-option-order-price"><span>0</span> —Ä—É–±.</div>
                        <input type="button" value="–ó–∞–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä" class="toStep3" data-name="–ö–æ–º—Ñ–æ—Ä—Ç"
                            data-price-per-km="30">
                    </div>
                </div>
                <div class="car-option" data-name="–ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å" data-price-per-km="50">
                    <div class="car-option-image">
                        <img src="mikroavtobus.png"
                            alt="mikroavtobus">
                    </div>
                    <div class="car-option-info">
                        <div class="car-option-title">–ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å (–¥–æ 7 —á–µ–ª–æ–≤–µ–∫)</div>
                        <div class="car-option-brands">
                            Hyundai Grand Starex, Volkswagen Caravelle, Kia Carnival, Ford Torneo, Hyundai Staria,
                            Nissan Elgrand</div>
                        <div class="car-option-size">
                            <div><span class="icon_people"></span>–¥–æ 7 —á–µ–ª–æ–≤–µ–∫</div>
                            <div><span class="icon_cases"></span>–¥–æ 7 —á–µ–º–æ–¥–∞–Ω–æ–≤</div>
                        </div>
                    </div>
                    <div class="car-option-order">
                        <small class="car-option-order-points"></small>
                        <div class="car-option-order-price"><span>0</span> —Ä—É–±.</div>
                        <input type="button" value="–ó–∞–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä" class="toStep3" data-name="–ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å"
                            data-price-per-km="50">
                    </div>
                </div>
                <div class="car-option" data-name="–ë–∏–∑–Ω–µ—Å" data-price-per-km="60">
                    <div class="car-option-image">
                        <img src="biznes.png" alt="biznes">
                    </div>
                    <div class="car-option-info">
                        <div class="car-option-title">–ë–∏–∑–Ω–µ—Å (–¥–æ 4 —á–µ–ª–æ–≤–µ–∫)</div>
                        <div class="car-option-brands">
                            Toyota Camry, Hyundai Sonata, Kia K5, Genesis G70, FAW Bestune B70, Chery Arrizo 8</div>
                        <div class="car-option-size">
                            <div><span class="icon_people"></span>–¥–æ 4 —á–µ–ª–æ–≤–µ–∫</div>
                            <div><span class="icon_cases"></span>–¥–æ 3 —á–µ–º–æ–¥–∞–Ω–æ–≤</div>
                        </div>
                    </div>
                    <div class="car-option-order">
                        <small class="car-option-order-points"></small>
                        <div class="car-option-order-price"><span>0</span> —Ä—É–±.</div>
                        <input type="button" value="–ó–∞–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä" class="toStep3" data-name="–ë–∏–∑–Ω–µ—Å"
                            data-price-per-km="60">
                    </div>
                </div>
            </div>
            <div id="map"></div>
        </div>

        <div class="step" id="step3">
            <div id="step3content">
                some personal data
            </div>
            <span id="backToStart">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ–µ–∑–¥–∫–∏</span>
        </div>
    </form>

    <script>
        const transferForm = document.querySelector('#transferForm');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const toStep2Button = document.getElementById('toStep2');
        const toStep3Button = document.querySelectorAll('.toStep3');
        const backToStart = document.getElementById('backToStart');
        // const carOptionsContainer = document.querySelector('.car-options');

        let routeFields = {
            date: null,
            departure: null,
            destination: null,
            distance: null,
            totalPrice: null,
            carClass: null,
            rate: null
        }

        toStep2Button.addEventListener('click', function () {
            routeFields.date = document.getElementById('start').value;
            routeFields.departure = document.getElementById('departure').value;
            routeFields.destination = document.getElementById('destination').value;

            if (!routeFields.departure || !routeFields.destination) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.');
                return;
            }
            if (!routeFields.date) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
                return;
            }

            step2.classList.add('active');
            document.getElementById('map').innerHTML = '';
            document.getElementById('departure-suggestions').innerHTML = '';
            document.getElementById('destination-suggestions').innerHTML = '';
            // step2.scrollIntoView();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
            ymaps.ready(init);
        });

        toStep3Button.forEach(btn => {
            btn.addEventListener('click', function () {
                routeFields.carClass = this.getAttribute('data-name');
                routeFields.totalPrice = Math.round((routeFields.distance * this.getAttribute('data-price-per-km')) / 10) * 10;
                routeFields.rate = this.getAttribute('data-price-per-km');
                step1.classList.remove('active');
                step2.classList.remove('active');
                step3.classList.add('active');
                console.log(routeFields);
                document.querySelector('#step3content').innerHTML = `<code>${JSON.stringify(routeFields)}</code>`;
            })
        });

        function init() {
            const map = new ymaps.Map("map", {
                center: [44.723771, 37.768813], // –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫)
                zoom: 7,
                controls: ['typeSelector', 'fullscreenControl', 'zoomControl']
            });

            ymaps.route([routeFields.departure, routeFields.destination]).then(function (route) {
                const from = route.requestPoints[0];
                const to = route.requestPoints[1];

                map.geoObjects.add(route);

                routeFields.distance = (route.getLength() / 1000).toFixed(0); // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –∫–º

                const carOptions = document.querySelectorAll('#car-options .car-option');

                carOptions.forEach(car => {
                    // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–µ–∑–¥–∫–∏ –≤ —Ä—É–±–ª—è—Ö —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ 10 —Ä—É–±–ª–µ–π
                    totalPrice = Math.round((routeFields.distance * car.getAttribute('data-price-per-km')) / 10) * 10;
                    car.querySelector('.car-option-order-price span').innerHTML = totalPrice;
                    car.querySelector('.car-option-order-points').innerHTML = `${routeFields.departure} ‚Üí ${routeFields.destination}`;
                });
            }, function (error) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç');
            });
        }

        backToStart.addEventListener('click', function () {
            step1.classList.add('active');
            step2.classList.add('active');
            step3.classList.remove('active');
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
        function showSuggestions(input, suggestionsContainer, citiesList) {
            const inputValue = input.value.toLowerCase();
            suggestionsContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

            if (inputValue) {
                citiesList.forEach(city => {
                    if (city.textContent.toLowerCase().includes(inputValue)) {
                        const suggestionItem = document.createElement('div');
                        suggestionItem.classList.add('suggestion-item');
                        suggestionItem.textContent = city.textContent;
                        suggestionItem.addEventListener('click', () => {
                            input.value = city.textContent;
                            suggestionsContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
                        });
                        suggestionsContainer.appendChild(suggestionItem);
                    }
                });
            }
        }

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –≤–≤–æ–¥–∞ –∫ –ø–æ–ª—è–º
        document.getElementById('departure').addEventListener('input', function () {
            showSuggestions(this, document.getElementById('departure-suggestions'),
                document.querySelectorAll('#cities-list li')
            );
        });

        document.getElementById('destination').addEventListener('input', function () {
            showSuggestions(this, document.getElementById('destination-suggestions'),
                document.querySelectorAll('#cities-list-destination li')
            );
        });

        // transferForm.addEventListener('submit', ()=> {
        //     console.log(new FormData(this));
        // })
    </script>

</body>

</html>